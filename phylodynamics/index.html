---
title: Bayesian Phylodynamics
layout: presentation
reveal:
    theme: theme.css
---

<section class="titlepage center">

  <div class="title">
    Bayesian Phylodynamics
  </div>

  <div class="authors">
    Tim Vaughan
  </div>
  
  <div class="institution">
    ETH ZÃ¼rich
  </div>

  <div class="date">
    C3BI Course: Introduction to Molecular Phylogenetics<br>
    Hong Kong 2018
  </div>

</section>

<section>
  <h1>From tree priors...</h1>

  <ul>
    <li>In the first lecture on Bayesian phylogenetics, we briefly mentioned the role of tree-generating models.</li>
  </ul>

  <img data-src="Data_generation.svg" style="width:80%;text-align:center">

  <div class="flipper" style="height:300px;margin-top:50px">
    <img data-src="Posterior_treeprior_nohl.svg" class="fragment">
    <img data-src="Posterior_treeprior.svg" class="fragment">
  </div>
</section>

<section>
<h1>... to Phylodynamics</h1>

<dl class="spaced" style="margin-top:100px">
  <dt>Phylodynamics:</dt>
  <dd>the study of how ecological and evolutionary processes act/interact to shape the evolutionary history of pathogens (Grenfell et al., 2004; Volz et al., 2014).</dd>

  <dt data-spacing="1em">Phylodynamic inference:</dt>
  <dd>the statistical practice of inferring ecological/evolutionary dynamics from phylodynamic trees.</dd>
</dl>
  
</section>

<section>
  <h1>Example: An emerging epidemic</h1>

  <ul class="spaced" style="margin-top:100px;">
    <li>Consider a newly-emerging viral epidemic.</li>

    <li>Assume we have sequence data from which we can reconstruct a
      dated phylogenetic tree.</li>

    <li>We are interested in estimating epidemic dynamics and important
      epidemiological parameters like the epidemic growth rate.</li>
  </ul>
</section>

<section class="center">
  <div class="flipper" style="margin-top:100px">
    <img data-src="example_epidemic1.svg">
    <img data-src="example_epidemic2.svg" class="fragment">
    <img data-src="example_epidemic3.svg" class="fragment">
    <img data-src="example_epidemic4.svg" class="fragment">
    <img data-src="example_epidemic5.svg" class="fragment">
  </div>

</section>

<section>
  <h1>The need for phylodynamic models</h1>

  <ul class="spaced" style="margin-top:10%">
    <li class="fragment">Phylogenies only contain the ancestry of the
    individuals we sample.</li>

    <li class="fragment" style="margin-top:10%">We therefore need a
    statistical model that will allow us to infer the
      most probable epidemic dynamics and parameters given an incomplete phylogeny.</li>
  </ul>
</section>

<section>
  <h1>Classes of phylodynamic models</h1>

  <ul>
    <li class="fragment">Coalescent models
      <ul>
        <li class="fragment">Originally developed by John Kigman in a series of papers in 1982.</li>
        <li class="fragment">Extensions for dynamics and structured populations introduced by several authors.</li>
      </ul>
    </li>

    <li class="fragment" style="margin-top:5%">Birth-death models
      <ul>
        <li class="fragment">Theory for
        completely sampled contemporaneous trees developed by
        Elizabeth Thompson in her 1975 book "Human Evolutionary
        Trees".</li>
        <li class="fragment">Theory for trees conditioned on number of samples and extensions to incomplete sampling, sampling through time, structured populations, etc. developed by Tanja Stadler from 2008.</li>
      </ul>
    </li>
  </ul>
</section>

<section class="center">

  <img data-src="sampled_tree.svg" style="width:100%">

</section>

<section class="center">

  <h1>Questions?</h1>

</section>

<section class="center">
  <h1>Coalescent Theory</h1>
</section>

<section>
  <h1>The Wright-Fisher Model</h1>

  <div class="flipper" style="height:600px">
    <img data-src="WF1.svg" class="fragment">
    <img data-src="WF2.svg" class="fragment">
    <img data-src="WF3.svg" class="fragment">
    <img data-src="WF4.svg" class="fragment">
    <img data-src="WF5.svg" class="fragment">
    <img data-src="WF6.svg" class="fragment">
  </div>

  <!-- assumptions -->
</section>

<section>
  <h1>Wright-Fisher Model Assumptions</h1>

  <img data-src="WF6.svg" style="width:50%">

  <ul>
    <li>Discrete generations.</li>
    <li>Individuals identical. (No structure.)</li>
    <li>Fixed offspring distribution (mean of 1)</li>
    <li>Constant + finite population size.</li>
    <li>An interpretation: population at equilibrium (carrying capacity).</li>
  </ul>

</section>

<section>
  <h1>Sampled WF phylogeny</h1>

  <div class="flipper">
    <img data-src="WFsamp1.svg">
    <img data-src="WFsamp2.svg" class="fragment">
    <img data-src="WFsamp3.svg" class="fragment">
    <img data-src="WFsamp4.svg" class="fragment">
    <img data-src="WFsamp5.svg" class="fragment">
    <img data-src="WFsamp6.svg" class="fragment">
    <img data-src="WFsamp7.svg" class="fragment">
  </div>
</section>

<section>
  <h1>Sampled WF phylogeny</h1>

    <img data-src="WFsamp7.svg" style="width:70%">

    <ul>
      <li>Generations between internal nodes related to population size.</li>
      <li class="fragment">Can we quantify this relationship?</li>
    </ul>
</section>

<section>
  <h1>Sampled 2-individual phylogeny</h1>

  <div class="flipper" style="height:400px">
    <img data-src="WF2sampCoal1.svg">
    <img data-src="WF2sampCoal2.svg" class="fragment">
    <img data-src="WF2sampCoal3.svg" class="fragment">
    <img data-src="WF2sampCoal4.svg" class="fragment">
    <img data-src="WF2sampCoal5.svg" class="fragment">
    <img data-src="WF2sampCoal6.svg" class="fragment">
    <img data-src="WF2sampCoal7.svg" class="fragment">
    <img data-src="WF2sampCoal8.svg" class="fragment">
    <img data-src="WF2sampCoal9.svg" class="fragment">
    <img data-src="WF2sampCoal10.svg" class="fragment">
    <img data-src="WF2sampCoal11.svg" class="fragment">
  </div>
  
  <p class="fragment">
    Probability of coalescence in generation $i-m$:
    $P(m)=(1-p_{\textrm{coal}})^{m-1}p_{\textrm{coal}}$
  </p>

  <p class="fragment">
    Continuous time limit (large $N$, small $g$): $P(t)=e^{-\frac{1}{Ng}t}\frac{1}{Ng}$
  </p>

  <!-- properties: geometric distribution -->
</section>

<section>
  <h1>The exponential distribution</h1>


  <div id="expDistPlot" style="width:1000px;height:500px">
    <script>
      target = document.getElementById('expDistPlot');

      var tarr = [];
      var p1 = [];
      var p2 = [];
      var p3 = [];
      var tmax = 3.0;
      for (var t=0; t<=tmax; t+= tmax/500) {
          tarr.push(t);
          p3.push(Math.exp(-2*t)*2);
          p1.push(Math.exp(-t));
          p2.push(Math.exp(-0.5*t)*0.5);
      }

      var trace1 = {x: tarr, y: p1, name: 'Ng=0.5', line: {width: 4}};
      var trace2 = {x: tarr, y: p2, name: 'Ng=1', line: {width: 4}};
      var trace3 = {x: tarr, y: p3, name: 'Ng=2', line: {width: 4}};

      Plotly.plot(target,
                  [trace1, trace2, trace3],
                  { 
                      margin: { t: 0 },
                      xaxis: {title: "Time before present"},
                      yaxis: {title: "Probability density"},
                      font: {size: 20}
                  },
                  {displayModeBar: false});
    </script>
  </div>
</section>

<section>

  <h1>Sampled k-individual phylogeny</h1>
  <div class="flipper" style="height:400px">
    <img data-src="WF3sampCoal1.svg">
    <img data-src="WF3sampCoal2.svg" class="fragment">
    <img data-src="WF3sampCoal3.svg" class="fragment">
    <img data-src="WF3sampCoal4.svg" class="fragment">
  </div>

  <p class="fragment">
    <b>Question:</b> How can this be generalized to $k$ samples?
  </p>
  <p class="fragment">
    <b>Answer:</b> $p_{\text{coal}}=\frac{k(k-1)}{2}\frac{1}{N}=\binom{k}{2}\frac{1}{N}$
  </p>

</section>

<section>
  <h1>Kingman's coalescent</h1>

  <div style="display:inline-block;vertical-align:middle;width:60%" class="spaced">
    <ul>
      <li>Backward-time Markov process which produces 
        sampled time trees.</li>
      <li>Equivalent to sampled trees produced by WF
        model when $N\gg k$ and $g\ll 1$.</li>
      <li>Times between coalescence events drawn
        from exponential distributions with rate $\binom{k}{2}\frac{1}{Ng}$.</li>
      <li>Interesting: expected time to MRCA is always $\leq \frac{2}{Ng}$, regardless of how many samples there are.</li>
    </ul>
  </div>
  <div style="display:inline-block;vertical-align:middle;width:39%">
    <img data-src="simulated_coal_trees.svg">
  </div>
</section>

<section>
  <h1>Effective population size</h1>

  <ul>
    <li>If a real population were described precisely by a Wright-Fisher model with generation time $g$, the $N$ parameter in the coalescent would correspond to the real population size.</li>
    <li>However, real populations are more complicated:
      <ul>
        <li>Random mating assumption is often violated,</li>
        <li>Offspring distribution may differ from that assumed by WF,</li>
        <li>Generations may be overlapping,</li>
        <li>...</li>
      </ul>
      <li>We therefore define the <b>effective population size</b>
      $N_e$ to be the size of a statistically equivalent WF population.
      (We often also absorb other parameters such as $g$, the clock
      rate and ploidy into this number.)</li>
  </ul>
  
</section>

<section>
  <h1>Probability of a coalecent tree</h1>
</section>

<section>
  <h1>Coalescent-based inference</h1>
</section>

<section>
  <h1>Robustness of the coalescent</h1>
</section>

<section>
  <h1>General assumptions of the coalescent</h1>
</section>

<section class="center">
  <h1>Questions?</h1>
</section>

<section>
  <h1>Extensions to the coalescent</h1>

  <ul class="spaced" style="margin-top:10%">
    <li>Population changing through time.</li>
    <li>Population structured in some way.</li>
  </ul>
</section>

<section>
  <h1>Extension: population size changes</h1>
</section>

<section>
  <h1>Probability of a coalescent tree</h1>
</section>

<section>
  <h1>Assumptions of time-dependent coalescent</h1>
</section>

<section>
  <h1>Example application</h1>
</section>

<section>
  <h1>Non-parametric models: Skyline plots</h1>
</section>

<section>
  <h1>Extension: population structure</h1>
</section>

<section>
  <h1>Coalescent summary</h1>
</section>

<section class="center">
  <h1>Questions?</h1>
</section>
  
<!--
* What is phylodynamics?
* Example application
* Need for phylodynamic models
* Phylodynamic models: birth-death and coalescent

- Question break -

* Coalescent theory (WF)
* Effective population size
* Coal tree prior and inference

- Question break -

* Population dynamics (parametric, non-parametric)
* Population structure (structured coalescent)
* Coalescent summary

- Question break -

* Birth-death models of population dynamics (reaction formalism)
* Retrospective view

  -->
