---
title: Bayesian Phylodynamics
layout: presentation
reveal:
    theme: theme.css
---

<section class="titlepage center">

  <div class="title">
    Bayesian Phylodynamics
  </div>

  <div class="authors">
    Tim Vaughan
  </div>
  
  <div class="institution">
    ETH ZÃ¼rich, Switzerland
  </div>

  <div class="date">
    C3BI Course: Introduction to Molecular Phylogenetics<br>
    Hong Kong 2018
  </div>

</section>

<section>
  <h1>From tree priors...</h1>

  <ul>
    <li>In the first lecture on Bayesian phylogenetics, we briefly mentioned the role of tree-generating models.</li>
  </ul>

  <img data-src="Data_generation.svg" style="width:80%;text-align:center">

  <div class="flipper" style="height:300px;margin-top:50px">
    <img data-src="Posterior_treeprior_nohl.svg" class="fragment">
    <img data-src="Posterior_treeprior.svg" class="fragment">
  </div>
</section>

<section>
<h1>... to Phylodynamics</h1>

<dl class="spaced" style="margin-top:100px">
  <dt>Phylodynamics:</dt>
  <dd>the study of how ecological and evolutionary processes act/interact to shape the evolutionary history of pathogens (Grenfell et al., 2004; Volz et al., 2014).</dd>

  <dt data-spacing="1em">Phylodynamic inference:</dt>
  <dd>the statistical practice of inferring ecological/evolutionary dynamics from phylodynamic trees.</dd>
</dl>
  
</section>

<section>
  <h1>Example: An emerging epidemic</h1>

  <ul class="spaced" style="margin-top:100px;">
    <li>Consider a newly-emerging viral epidemic.</li>

    <li>Assume we have sequence data from which we can reconstruct a
      dated phylogenetic tree.</li>

    <li>We are interested in estimating epidemic dynamics and important
      epidemiological parameters like the epidemic growth rate.</li>
  </ul>
</section>

<section class="center">
  <div class="flipper" style="margin-top:100px">
    <img data-src="example_epidemic1.svg">
    <img data-src="example_epidemic2.svg" class="fragment">
    <img data-src="example_epidemic3.svg" class="fragment">
    <img data-src="example_epidemic4.svg" class="fragment">
    <img data-src="example_epidemic5.svg" class="fragment">
  </div>

</section>

<section>
  <h1>The need for phylodynamic models</h1>

  <ul class="spaced" style="margin-top:10%">
    <li class="fragment">Phylogenies only contain the ancestry of the
    individuals we sample.</li>

    <li class="fragment" style="margin-top:10%">We therefore need a
    statistical model that will allow us to infer the
      most probable epidemic dynamics and parameters given an incomplete phylogeny.</li>
  </ul>
</section>

<section>
  <h1>Classes of phylodynamic models</h1>

  <ul>
    <li class="fragment">Coalescent models
      <ul>
        <li class="fragment">Originally developed by John Kingman in a series of papers in 1982.</li>
        <li class="fragment">Extensions for dynamics and structured populations introduced by several authors.</li>
      </ul>
    </li>

    <li class="fragment" style="margin-top:5%">Birth-death models
      <ul>
        <li class="fragment">Theory for
        completely sampled contemporaneous trees developed by
        Elizabeth Thompson in her 1975 book "Human Evolutionary
        Trees".</li>
        <li class="fragment">Theory for trees conditioned on number of samples and extensions to incomplete sampling, sampling through time, structured populations, etc. developed by Tanja Stadler from 2008.</li>
      </ul>
    </li>
  </ul>
</section>

<section class="center">

  <img data-src="sampled_tree.svg" style="width:100%">

</section>

<section class="center">

  <h1>Questions?</h1>

</section>

<section class="center">
  <h1>Coalescent Theory</h1>
</section>

<section>
  <h1>The Wright-Fisher Model</h1>

  <div class="flipper" style="height:600px">
    <img data-src="WF1.svg" class="fragment">
    <img data-src="WF2.svg" class="fragment">
    <img data-src="WF3.svg" class="fragment">
    <img data-src="WF4.svg" class="fragment">
    <img data-src="WF5.svg" class="fragment">
    <img data-src="WF6.svg" class="fragment">
  </div>

  <!-- assumptions -->
</section>

<section>
  <h1>Wright-Fisher Model Assumptions</h1>

  <img data-src="WF6.svg" style="width:50%">

  <ul>
    <li>Discrete generations.</li>
    <li class="fragment">Individuals identical. (No structure.)</li>
    <li class="fragment">Fixed offspring distribution (mean of 1)</li>
    <li class="fragment">Constant + finite population size.</li>
    <li class="fragment">An interpretation: population at equilibrium (carrying capacity).</li>
  </ul>

</section>

<section>
  <h1>Sampled WF phylogeny</h1>

  <div class="flipper">
    <img data-src="WFsamp1.svg">
    <img data-src="WFsamp2.svg" class="fragment">
    <img data-src="WFsamp3.svg" class="fragment">
    <img data-src="WFsamp4.svg" class="fragment">
    <img data-src="WFsamp5.svg" class="fragment">
    <img data-src="WFsamp6.svg" class="fragment">
    <img data-src="WFsamp7.svg" class="fragment">
  </div>
</section>

<section>
  <h1>Sampled WF phylogeny</h1>

    <img data-src="WFsamp7.svg" style="width:70%">

    <ul>
      <li>Generations between internal nodes related to population size.</li>
      <li class="fragment">Can we quantify this relationship?</li>
    </ul>
</section>

<section>
  <h1>Sampled 2-individual phylogeny</h1>

  <div class="flipper" style="height:400px">
    <img data-src="WF2sampCoal1.svg">
    <img data-src="WF2sampCoal2.svg" class="fragment">
    <img data-src="WF2sampCoal3.svg" class="fragment">
    <img data-src="WF2sampCoal4.svg" class="fragment">
    <img data-src="WF2sampCoal5.svg" class="fragment">
    <img data-src="WF2sampCoal6.svg" class="fragment">
    <img data-src="WF2sampCoal7.svg" class="fragment">
    <img data-src="WF2sampCoal8.svg" class="fragment">
    <img data-src="WF2sampCoal9.svg" class="fragment">
    <img data-src="WF2sampCoal10.svg" class="fragment">
    <img data-src="WF2sampCoal11.svg" class="fragment">
  </div>
  
  <p class="fragment">
    Probability of coalescence in generation $i-m$:
    $P(m)=(1-p_{\textrm{coal}})^{m-1}p_{\textrm{coal}}$
  </p>

  <p class="fragment">
    Continuous time limit (large $N$, small $g$): $P(t)=e^{-\frac{1}{Ng}t}\frac{1}{Ng}$
  </p>

  <!-- properties: geometric distribution -->
</section>

<section>
  <h1>The exponential distribution</h1>


  <div id="expDistPlot" style="width:1000px;height:500px">
    <script>
      target = document.getElementById('expDistPlot');

      var tarr = [];
      var p1 = [];
      var p2 = [];
      var p3 = [];
      var tmax = 3.0;
      for (var t=0; t<=tmax; t+= tmax/500) {
          tarr.push(t);
          p3.push(Math.exp(-2*t)*2);
          p1.push(Math.exp(-t));
          p2.push(Math.exp(-0.5*t)*0.5);
      }

      var trace1 = {x: tarr, y: p1, name: 'Ng=0.5', line: {width: 4}};
      var trace2 = {x: tarr, y: p2, name: 'Ng=1', line: {width: 4}};
      var trace3 = {x: tarr, y: p3, name: 'Ng=2', line: {width: 4}};

      Plotly.plot(target,
                  [trace1, trace2, trace3],
                  { 
                      margin: { t: 0 },
                      xaxis: {title: "Time before present"},
                      yaxis: {title: "Probability density"},
                      font: {size: 20}
                  },
                  {displayModeBar: false});
    </script>
  </div>
</section>

<section>

  <h1>Sampled k-individual phylogeny</h1>
  <div class="flipper" style="height:400px">
    <img data-src="WF3sampCoal1.svg">
    <img data-src="WF3sampCoal2.svg" class="fragment">
    <img data-src="WF3sampCoal3.svg" class="fragment">
    <img data-src="WF3sampCoal4.svg" class="fragment">
  </div>

  <p class="fragment">
    <b>Question:</b> How can this be generalized to $k$ samples?
  </p>
  <p class="fragment">
    <b>Answer:</b> $p_{\text{coal}}=\frac{k(k-1)}{2}\frac{1}{N}=\binom{k}{2}\frac{1}{N}$
  </p>

</section>

<section>
  <h1>Kingman's coalescent</h1>

  <div style="display:inline-block;vertical-align:middle;width:60%" class="spaced">
    <ul>
      <li>Backward-time Markov process which produces 
        sampled time trees.</li>
      <li class="fragment">Equivalent to sampled trees produced by WF
        model when $N\gg k$ and $g\ll 1$.</li>
      <li class="fragment">Times between coalescence events drawn
        from exponential distributions with rate $\binom{k}{2}\frac{1}{Ng}$.</li>
      <li class="fragment">Interesting: expected time to MRCA is always $\leq \frac{2}{Ng}$, regardless of how many samples there are.</li>
    </ul>
  </div>
  <div style="display:inline-block;vertical-align:middle;width:39%">
    <img data-src="simulated_coal_trees.svg">
  </div>
</section>

<section>
  <h1>Effective population size</h1>

  <ul>
    <li>If a real population were described precisely by a Wright-Fisher model with generation time $g$, the $N$ parameter in the coalescent would correspond to the real population size.</li>
    <li class="fragment">However, real populations are more complicated:
      <ul>
        <li>Random mating assumption is often violated,</li>
        <li>Offspring distribution may differ from that assumed by WF,</li>
        <li>Generations may be overlapping,</li>
        <li>...</li>
      </ul>
      <li class="fragment">We therefore define the <b>effective population size</b>
      $N_e$ to be the size of a statistically equivalent WF population.
      (We often also absorb other parameters such as $g$, the clock
      rate and ploidy into this number.)</li>
  </ul>
  
</section>

<section>
  <h1>Probability of a coalescent tree</h1>

  <center>
  <div class="flipper" style="width:70%;height:400px">
    <img data-src="coalProb1.svg">
    <img data-src="coalProb2.svg" class="fragment">
  </div>
  </center>

  <div class="fragment" style="margin-top:5%">
    \begin{equation}
    P(T|N_e)=\prod_{i=1}^{n-1}\left(\exp\left[-\Delta t_i\binom{k_i}{2}\frac{1}{N_e}\right]\frac{1}{N_e}\right)
    \end{equation}
  </div>
</section>

<section>
  <h1>Coalescent-based inference</h1>

  <ul>
    <li>We can therefore infer demographic parameters like $N_e$ given a known phylogeny!</li>
  </ul>

  $L(N_e|T)=P(T|N_e)$

  <div style="width:100%;margin-top:10%">
    <div id="coalDensity"
         style="width:400px;height:300px;display:inline-block;vertical-align:middle">
    <script>
      target = document.getElementById('coalDensity');

      var Ne = [];
      var p = [];
      var minNe=2.0;
      var maxNe=5.0;
      for (var thisNe=minNe; thisNe<=maxNe; thisNe += (maxNe-minNe)/200) {
          Ne.push(thisNe);
          p.push(-(12*0.5/thisNe + 3*1/thisNe + 1*1.3/thisNe) - 3*Math.log(thisNe));
      }

      var trace = {x: Ne, y: p, name: 'Ng=0.5', line: {width: 4}};

      Plotly.plot(target,
                  [trace],
                  { 
                      margin: { t: 0 },
                      xaxis: {title: "N"},
                      yaxis: {title: "log L(N|T)"},
                      font: {size: 20}
                  },
                  {displayModeBar: false});
    </script>
  </div>
  <div style="width:500px;display:inline-block;vertical-align:middle">
    <img data-src="coalProb2.svg">
  </div>
  </div>
</section>

<section>
  <h1>Robustness of the coalescent</h1>

  <ul>
    <li>The coalescent distribution/process is often derived as a limit of the Wright-Fisher process, as we have done here.</li>
    <li class="fragment">It also appears as the limit of many other population processes, for example
    <ul>
      <li>The Canning model (generalization of the Wright-Fisher model)</li>
      <li>The Moran model (overlapping generations, fixed population size)</li>
      <li>some stochastic logistic models (continuous time, population fluctuations)</li>
      <li>...</li>
    </ul>
    <li class="fragment">The fact that the coalescent distribution persists in the face
    of many departures from the WF model is sometimes termed the
    "robustness of the coalescent".</li>
  </ul>
</section>

<section>
  <h1>General assumptions of the coalescent</h1>

  <ol class="spaced" style="margin-top:10%">
    <li class="fragment">Samples are members of a population that is at demographic equilibrium.</li>
    <li class="fragment">Number of samples is small compared to the total population size.
      <ul>
        <li>Necessary for WF-based derivation, not all derivations.</li>
      </ul>
    <li class="fragment">Population is "well mixed", samples are drawn randomly.</li>
  </ol>
  </ol>
</section>

<section class="center">
  <h1>Questions?</h1>
</section>

<section>
  <h1>Extensions to the coalescent</h1>

  <ul class="spaced" style="margin-top:10%">
    <li>Population changing through time.</li>
    <li>Population structured in some way.</li>
  </ul>
</section>

<section>
  <h1>Extension: population size changes</h1>

  <div>
    <img data-src="WFpopDyn.jpg">
    <a href="" class="cite">K&uuml;hnert et al., 2011</a>
</section>

<section>
  <h1>Estimating population growth</h1>

  <ul>
    <li>The coalescent can be extended to accommodate time-varying population sizes.</li>
  </ul>

  <div style="display:inline-block;vertical-align:top;height:275px">
    <img data-src="HCV_growth_title.png">
  </div>
  <div style="display:inline-block;vertical-align:top;height:275px">
    <img data-src="HCV_growth_figure.png">
  </div>

  <div style="display:inline-block;vertical-align:middle;width:80%">
    <img data-src="HCV_growth_table.png">
  </div>
  
</section>

<section>
  <h1>Modeling population size changes</h1>

  <ul class="spaced" style="margin-top:10%">
    <li>Parametric models assume population size changes according to
    some deterministic function of time (e.g. exponential
    growth).</li>
    <li>Non-parametric models allow population size to change over
    time in a relatively unconstrained manner.</li>
  </ul>
</section>

<section>
  <h1>Non-parametric: Skyline plot</h1>

  <center>
  <div class="flipper" style="width:80%;height:550px;text-align:center">
    <img data-src="skyline_schematic1.svg" style="width:100%">
    <img data-src="skyline_schematic2.svg" style="width:100%" class="fragment" data-fragment-index="2">
  </div>
  </center>
  <ul style="margin-top:-2em" class="fragment" data-fragment-index="2">
    <li>Due to <a href="" class="cite">Pybus, Rambaut and Harvey, 2000</a>.</li>
    <li>Directly yields ML estimates of population size in each interval.</li>
  </ul>
  
</section>

<section>
  <h1>Bayesian skyline</h1>

  <ul class="spaced" style="margin-top:5%">
    <li class="fragment">Piecewise-constant population model: population size can only
    change at a fixed number of break points. Each time interval can
    contain several coalescent intervals.</li>

    <li class="fragment">Uses MCMC to integrate over all possible break point positions in addition to $N_e$ within each time interval.</li>

    <li class="fragment">Graphs of marginal probability of population size vs time
    appear smoothed due to averaging over possible histories.</li>
  </ul>
</section>

<section>
  <h1>Example: $N_e$ for HCV in Egypt</h1>

  <center>
    <img data-src="hcv_bsp.gif" style="width:60%">

    <div style="text-align:right;width:60%">
      <a href="" class="cite">Drummond et al., 2005</a>
    </div>
  </center>
  
</section>

<section>
  <h1>Example: $N_e$ for influenza (H3N2)</h1>

  <center>
    <img data-src="flu_bsp.jpg" style="width:80%">

    <div style="text-align:right;width:80%" >
      <a href="" class="cite">Rambaut et al., 2008</a>
    </div>
  </center>
  
</section>

<section>
  <h1>Extension: population structure</h1>

  <ul>
    <li>Other forces beyond population dynamics can strongly shape phylogenies.</li>
  </ul>

  <center>
    <img data-src="spatial_vs_temporal.png" style="height:400px">
  </center>
  <div style="text-align:right">
    <a href="" class="cite">Grenfell et al., Science 2004</a>
  </div>
  
</section>

<section>
  <h1>The effect of structure</h1>

  <ul class="spaced">
    <li>Standard coalescent models assume that all lineages in a tree are exchangeable.</li>
    <li class="fragment">Exchangeability here means that any lineages is equally likely to coalesce with any other.</li>
    <li class="fragment">Many forms of population structure violate this assumption.</li>
  </ul>

  <blockquote class="fragment">
    $\therefore$ With the right model, we can learn about population structure from phylogenies!
  </blockquote>
</section>

<section>
    <h1>The structured coalescent</h1>

    <div style="display:inline-block;width:49%;vertical-align:middle">
        <img data-src="structWF_genealogy.svg" style="width:100%">
    </div><div style="display:inline-block;width:49%;vertical-align:middle;text-align:left">
        <ul>
            <li>Backward in time genealogical process corresponding to taking
                the coalescent limit of a structured WF process.</li>
        </ul>

        <dl style="margin-top:0.5em">
            <dt>Coalescence rate in deme $i$:</dt>
            <dd>$$\binom{k_i}{2}\frac{1}{N_ig}$$</dd>
            <dt>Lineage migration rate $i\rightarrow j$:</dt>
            <dd>$$k_i m_{ij}$$</dd>
        </dl>
    </div>
</section>

<section>
  <h1>Example: H3N2 spatial dynamics</h1>

  <center>
    <img data-src="h3n2_SC.svg" style="width:65%">
  </center>
  <div style="text-align:right">
    <a href="" class="cite">Vaughan et al., 2014</a>
  </div>
</section>

<section>
  <h1>Bayesian structured coalescent methods</h1>

  <ul class="spaced">
    <li>MIGRATE <a href="" class="cite">(Beerli, Bioinformatics 2006)</a>
      <ul><li>Classic MCMC approach but slow for complex migration histories.</li></ul>
    </li>

    <li>MTT <a href="" class="cite">(Vaughan et al., Bioinformatics 2014)</a>
      <ul><li>Improved method, still slow. (BEAST 2)</li></ul>
    </li>
    <li>BASTA <a href="" class="cite">(De Maio et al., PLoS Genetics 2015)</a>
      <ul><li>Approximate but faster method. (BEAST 2)</li></ul>
    </li>
    <li>MASCOT <a href="" class="cite">(M&uuml;ller et al., MBE 2017)</a>
      <ul><li>Better approximate method. (BEAST 2)</li></ul>
    </li>
  </ul>
</section>


<section class="center">
  <h1>Questions?</h1>
</section>

<section class="center">
  <h1>Birth-death models in phylodynamics</h1>
</section>

<section>
  <h1>Birth-death population dynamics</h1>

  <ul>
    <li class="fragment">Population size described by a positive integer.</li>
    <li class="fragment">Changes through time according to a continuous time Markov process, similar to the substitution models we've already seen.</li>
  </ul>
  <p class="fragment">Can use a chemical reaction notation to describe rates and effects of possible events:</p>
  <dl class="fragment">
    <dt>Birth:</dt>
    <dd>$$X\overset{\lambda}{\longrightarrow} 2X$$</dd>
    <dt>Death:</dt>
    <dd>$$X\overset{\mu}{\longrightarrow} 0$$</dd>
  </dl>
  <p class="fragment">The parameters $\lambda$ and $\mu$ are probabilities per [time unit] that any given individual experiences a birth or a death.</p>

</section>

<section>
  <h1>Example BD dynamics</h1>

  <div id="bdExample" style="width:1000px; height:500px">
    <script>
      function getBDTrace() {
          var lambda = 1.2;
          var mu = 0.9;
          var tmax=10.0;

          var N = [1];
          var t = [0.0];
          while (true) {
              var thisN = N[N.length-1];
              var thist = t[t.length-1];
              
              var a_birth = lambda*thisN;
              var a_death = mu*thisN;
              var a0 = a_birth + a_death;

              var dt;
              if (a0>0.0)
                  dt = -Math.log(Math.random())/a0;
              else
                  dt = Infinity

              thist += dt;

              if (thist>tmax) {
                  t.push(tmax);
                  N.push(thisN);
                  break;
              }

              t.push(thist);

              if (Math.random()*a0 < a_birth)
                  N.push(thisN + 1);
              else
                  N.push(thisN - 1);
          }

          return {x: t, y: N, mode: 'lines', line: {width: 2, shape: 'hv'}};
      }

      function singleBDplot() {
          target = document.getElementById('bdExample');

          Plotly.newPlot(target,
                         [getBDTrace()],
                         { 
                             margin: { t: 20 },
                             xaxis: {title: "Time"},
                             yaxis: {title: "Population size"},
                             font: {size: 20}
                         },
                         {displayModeBar: false});
      }

      singleBDplot();
     
    </script>
    <div style="text-align:right;font-size:0.5em">
      <a href="" onclick="singleBDplot(); return false;">Regenerate</a>
    </div>
  </div>
</section>

<section>
  <h1>Example BD dynamics</h1>

  <div id="bdEnsembleTraj" style="width:550px;height:500px;display:inline-block">
  </div>
  <div id="bdEnsembleHist" style="width:400px;height:500px;display:inline-block">
  </div>

  <script>
    function ensemblePlot() {
        var traces = [];

        var nTraces = 400;
        for (var i=0; i<nTraces; i++) {
            traces.push(getBDTrace());
            traces[traces.length-1].line.width = 1;
            traces[traces.length-1].line.color = 'rgb(10,70,70)';
            traces[traces.length-1].opacity = 0.2;
        }

        var trajTarget = document.getElementById('bdEnsembleTraj');
        Plotly.newPlot(trajTarget, traces,
                       { 
                           showlegend: false,
                           margin: { t: 20 },
                           xaxis: {title: "Time"},
                           yaxis: {title: "Population size"},
                           font: {size: 20}
                       },
                       {displayModeBar: false});

        var finalSizes = [];
        for (i=0; i<nTraces; i++) {
            var finalSize = traces[i].y[traces[i].y.length-1];
            finalSizes.push(finalSize);
        }

        var histTarget = document.getElementById('bdEnsembleHist');
        Plotly.newPlot(histTarget,
                      [ {x: finalSizes, type: 'histogram'} ],
                      {
                          margin: { t: 20, l: 50, r: 0 },
                           xaxis: {title: "Final pop. size"},
                          font: {size: 20}
                      },
                      {displayModeBar: false});
    }

    ensemblePlot();
  </script>

  <div style="text-align:right;font-size:0.5em">
    <a href="" onclick="ensemblePlot(); return false;">Regenerate</a>
  </div>

</section>

<section>
  <h1>Birth-death branching process</h1>

  <div class="flipper">
    <img data-src="bd_branching1.svg">
    <img data-src="bd_branching2.svg" class="fragment">
    <img data-src="bd_branching3.svg" class="fragment">
    <img data-src="bd_branching4.svg" class="fragment">
    <img data-src="bd_branching5.svg" class="fragment">
    <img data-src="bd_branching6.svg" class="fragment">
  </div>

</section>

<section>
  <h1>Birth-death-sampling process</h1>

  <ul>
    <li class="fragment">The birth-death sampling process extends the birth-death process by incorporating a <b>model for sample generation</b>.</li>
    <li class="fragment">This can be described using the following reactions:
      <ul>
        <li><b style="padding-right:3em">Birth:</b> $X\overset{\lambda}{\longrightarrow}2X$</li>
        <li><b style="padding-right:3em">Death:</b> $X\overset{\mu}{\longrightarrow}0$</li>
        <li><b style="padding-right:3em">Sampling (with removal):</b> $X\overset{r\psi}{\longrightarrow}0$</li>
        <li><b style="padding-right:3em">Sampling without removal:</b> $X\overset{(1-r)\psi}{\longrightarrow}X$</li>
      </ul>
  </ul>

  <p class="fragment">Additionally, the model allows each surviving lineage at the end of the process (present day) to be sampled with probability $\rho$.</p>
</section>

<section>
  <h1>Birth-death-sampling trees</h1>

  <div class="flipper">
    <img data-src="bds_trees1.svg">
    <img data-src="bds_trees2.svg" class="fragment">
    <img data-src="bds_trees3.svg" class="fragment">
    <img data-src="bds_trees4.svg" class="fragment">
    <img data-src="bds_trees5.svg" class="fragment">
    <img data-src="bds_trees6.svg" class="fragment">
    <img data-src="bds_trees7.svg" class="fragment">
    <img data-src="bds_trees8.svg" class="fragment">
    <img data-src="bds_trees9.svg" class="fragment">
    <img data-src="bds_trees10.svg" class="fragment">

</section>

<section>
  <h1>Birth-death parameterizations</h1>

  <p>There are several distinct parameterizations, including:</p>

  <ol>
    <li>Bare reaction rate parameterization:
      <ul>
        <li>Birth rate $\lambda$</li>
        <li>Death/recovery rate $\mu$</li>
        <li>Sampling rate $\psi$</li>

      </ul>
    </li>
    <li style="margin-top:1em">Epidemiological parameterization:
      <ul>
        <li>Effective reproductive number $R_e$ ($=\lambda/\mu$)</li>
        <li>Death/recovery rate $\mu$</li>
        <li>Sampling proportion $\psi/(\psi+\mu)$</li>
      </ul></li>
  </ol>

  <p>Note there are subtly different ways of handling the removal on
    sampling probability too.</p>
</section>

<section>
  <h1>Sampled birth-death tree prior</h1>

  <div style="text-align:right">
    <img data-src="stadler2010.png">
    <a href="" class="cite">Tanja Stadler, J. Theor. Biol., 2010</a>
  </div>

  <div class="fragment">
  $$P(T|\lambda,\mu,\psi,r,t_{or})=\lambda^{n+m-1}\psi^{k+m}(4\rho)^n\prod_{i=0}^{n+m-1}\frac{1}{q(x_i)}\prod_{i=1}^{m}p_0(y_i)q(y_i)$$
  </div>
  
</section>

<section>
  <h1>Birth-death model assumptions</h1>

  <ol class="spaced" style="margin-top:5%">
    <li class="fragment">Samples are members of a stochastically varying population that is on average exponentially growing with rate $\lambda-(\mu+r\psi)$.</li>

    <li class="fragment">Sample fraction can be small, large or complete - tree prior is still valid.</li>

    <li class="fragment">Sample number and times are assumed to be produced according to the model: deviation from this assumption results in biased inferences.</li>

    <li class="fragment">Population is "well mixed", samples are drawn randomly.</li>
  </ol>
    
</section>

<section>
  <h1>Application: Penguin radiation</h1>

  <center>
    <img data-src="penguins.png" style="width:80%">
  </center>
  <div style="text-align:right">
    <a href="" class="cite">Gavryushkina et al., 2017</a>
  </div>
  
</section>
<section>
  <h1>Application: Penguin radiation</h1>

  <center>
  <img data-src="penguins_SA.png" style="width:60%">
  </center>
  
</section>


<section>
  <h1>Extension: time-dependence</h1>

  <ul>
    <li>The birth-death skyline model allows piecewise-constant variation in rate parameters.</li>
  </ul>

  <center>
  <img data-src="bdsky.png" style="width:80%">
  </center>
  <div style="text-align:right">
    <a href="" class="cite">Stadler et al., 2013</a>
  </div>
</section>

<section>
  <h1>Example: Hepatitis C in Egypt</h1>

  <ul>
    <li>Effective reproductive number $R_e(t)$ generalizes basic reproductive number $R_0=R_e(0)$.</li>
    <li>Analysis of 63 sequences, $R_e(t)=\lambda(t)/\mu(t)$.</li>
  </ul>
  <img data-src="hcv_bdsky.svg" style="width:100%">
  <div style="text-align:right">
    <a href="" class="cite">Stadler et al., 2013</a>
  </div>
</section>


<section>
  <h1>Extension: structured populations</h1>

  <ul>
    <li>Introduced by <a href="" class="cite">K&uuml;hnert et al., 2016</a>.</li>
    <li>Multi-type birth-death model includes populations consisting of two or more distinct types.</li>
    <li>Each type may have its own birth, death and sampling rate.</li>
    <li>Transitions between types occur as the result of additional reactions:
      <ul>
        <li><b style="margin-right:3em">Migration:</b> $X_i\overset{\m_{ij}}{\longrightarrow}X_j$</li>
        <li><b style="margin-right:3em">Inter-type birth:</b> $X_i\overset{\lambda_{ij}}{\longrightarrow}X_i+X_j$</li>
        </ul></li>
  </ul>
</section>

<section>
  <h1>Example: Seasonal H3N2 dynamics</h1>

  <center>
  <img data-src="flu_bdmm.svg" style="height:500px">
  </center>
  <div style="text-align:right">
    <a href="" class="cite">K&uuml;hnert et al., 2016</a>
  </div>
  

</section>

<section class="center">
  <h1>Questions?</h1>
</section>

<section class="center">
  <h1>Birth-death vs Coalescent models</h1>
  <h3 class="fragment">How do I choose?</h3>
</section>

<section>
  <div style="margin-top:10%">
    <div style="display:inline-block;width:45%;vertical-align:top">
      <h1>Birth-death</h1>
      <ul class="spaced">
        <li class="fragment" data-fragment-index="1">Parameters: transmission rates, removal rates, sampling rates/proportions</li>
        <li class="fragment" data-fragment-index="2">Models sampling process (sample times/locations are data)</li>
      </ul>
    </div>
    <div style="display:inline-block;width:45%;vertical-align:top">
      <h1>Coalescent</h1>
      <ul class="spaced">
        <li class="fragment" data-fragment-index="1">Parameters: effective population size (NOT actual population size)</li>
        <li class="fragment" data-fragment-index="2">Assumes number of sampled lineages small ($k\ll N$)</li>
      </ul>
    </div>
  </div>
</section>

<section>
  <h1>Birth-death models</h1>

  <div style="margin-top:10%">
    <div style="display:inline-block;width:45%;vertical-align:top">
      <h3>Advantages</h3>

      <ul>
        <li class="fragment">Accounts for stochastic variability in population dynamics.</li>
        <li class="fragment">Generally easier interpretation of parameters.</li>
        <li class="fragment">Uses information about sampling.</li>
      </ul>
    </div>
    <div style="display:inline-block;width:45%;vertical-align:top">
      <h3>Disadvantages</h3>
      <ul>
        <li class="fragment">Sensitive to unmodeled changes in sampling fractions.</li>
        <li class="fragment">Difficult to extend to complex population models.</li>
      </ul>
    </div>
  </div>

</section>

<section>
  <h1>Coalescent models</h1>

  <div style="margin-top:10%">
    <div style="display:inline-block;width:45%;vertical-align:top">
      <h3>Advantages</h3>

      <ul>
        <li class="fragment">Generally fast tree prior calculations</li>
        <li class="fragment">Easy to extend to complex population dynamics (see Volz, 2012)</li>
        <li class="fragment">Naturally account for incomplete sampling.</li>
      </ul>
    </div>
    <div style="display:inline-block;width:45%;vertical-align:top">
      <h3>Disadvantages</h3>
      <ul>
        <li class="fragment">Sensitive to uncertainty in population dynamics at high sampling (Boskova et al., 2014)</li>
        <li class="fragment">Sensitive to hidden population structure and nonrandom sampling.</li>
      </ul>
    </div>
  </div>
</section>

<section>
  <h1>Conclusions</h1>

  <ul class="spaced" style="margin-top:10%">
    <li class="fragment">Both birth-death and coalescent models probabilistically relate a population's demography to its phylogenetic history.</li>

    <li class="fragment">Both allow for model-based inference of demographic and epidemiological parameters but may differ in their parameterization.</li>

    <li class="fragment">Which model to use depends on what assumptions you are willing to make and what you want to infer.</li>
  </ul>

</section>

<!--
* What is phylodynamics?
* Example application
* Need for phylodynamic models
* Phylodynamic models: birth-death and coalescent

- Question break -

* Coalescent theory (WF)
* Effective population size
* Coal tree prior and inference

- Question break -

* Population dynamics (parametric, non-parametric)
* Population structure (structured coalescent)
* Coalescent summary

- Question break -

* Birth-death-sampling models of population dynamics (reaction formalism)
* Retrospective view
* Derivation of p0, p1 ODEs.
* FBD model (sampled ancestors, penguin example)
* BDSKY model (HCV comparison)
* Multi-type BD (Flu again)

- Question break -

* Pros and cons: coalescent vs birth-death
  -->
